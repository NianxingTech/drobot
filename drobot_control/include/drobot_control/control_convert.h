#ifndef CONTROLCONVERT_H
#define CONTROLCONVERT_H
#include <math.h>

#define PI			3.1415926	

#define MAX_VELOCITY		2.0
#define MAX_HIGH_VELOCITY		5.0
#define POINT_TURN_VELOCITY		0.5

#define POINT_TURN_ANGLE  50.47737 
#define BIAS_STEER		0.0


// Look-up table
double TURN_IN[193] = {-24,-23.75,-23.5,-23.25,-23,-22.75,-22.5,-22.25,-22,-21.75,-21.5,-21.25,-21,-20.75,-20.5,-20.25,-20,-19.75,-19.5,-19.25,-19,-18.75,-18.5,-18.25,-18,-17.75,-17.5,-17.25,-17,-16.75,-16.5,-16.25,-16,-15.75,-15.5,-15.25,-15,-14.75,-14.5,-14.25,-14,-13.75,-13.5,-13.25,-13,-12.75,-12.5,-12.25,-12,-11.75,-11.5,-11.25,-11,-10.75,-10.5,-10.25,-10,-9.75,-9.5,-9.25,-9,-8.75,-8.5,-8.25,-8,-7.75,-7.5,-7.25,-7,-6.75,-6.5,-6.25,-6,-5.75,-5.5,-5.25,-5,-4.75,-4.5,-4.25,-4,-3.75,-3.5,-3.25,-3,-2.75,-2.5,-2.25,-2,-1.75,-1.5,-1.25,-1,-0.75,-0.5,-0.25,0,0.25,0.5,0.75,1,1.25,1.5,1.75,2,2.25,2.5,2.75,3,3.25,3.5,3.75,4,4.25,4.5,4.75,5,5.25,5.5,5.75,6,6.25,6.5,6.75,7,7.25,7.5,7.75,8,8.25,8.5,8.75,9,9.25,9.5,9.75,10,10.25,10.5,10.75,11,11.25,11.5,11.75,12,12.25,12.5,12.75,13,13.25,13.5,13.75,14,14.25,14.5,14.75,15,15.25,15.5,15.75,16,16.25,16.5,16.75,17,17.25,17.5,17.75,18,18.25,18.5,18.75,19,19.25,19.5,19.75,20,20.25,20.5,20.75,21,21.25,21.5,21.75,22,22.25,22.5,22.75,23,23.25,23.5,23.75,24};
double LEFT_UP[193] = {-10.651,-10.548,-10.445,-10.341,-10.238,-10.134,-10.031,-9.927,-9.824,-9.720,-9.616,-9.512,-9.408,-9.304,-9.200,-9.096,-8.991,-8.887,-8.782,-8.678,-8.573,-8.468,-8.363,-8.258,-8.153,-8.047,-7.942,-7.836,-7.730,-7.625,-7.518,-7.412,-7.306,-7.199,-7.093,-6.986,-6.879,-6.772,-6.664,-6.557,-6.449,-6.341,-6.233,-6.125,-6.017,-5.908,-5.799,-5.690,-5.581,-5.471,-5.361,-5.252,-5.141,-5.031,-4.920,-4.809,-4.698,-4.587,-4.475,-4.363,-4.251,-4.139,-4.026,-3.913,-3.800,-3.686,-3.573,-3.459,-3.344,-3.229,-3.114,-2.999,-2.883,-2.767,-2.651,-2.535,-2.418,-2.300,-2.183,-2.065,-1.946,-1.828,-1.709,-1.589,-1.469,-1.349,-1.228,-1.107,-0.986,-0.864,-0.742,-0.619,-1.496,-0.373,-0.249,-0.125,0.000,0.125,0.251,0.377,0.504,0.631,0.758,0.886,1.015,1.144,1.274,1.404,1.534,1.665,1.797,1.929,2.062,2.195,2.329,2.463,2.598,2.734,2.870,3.007,3.144,3.282,3.421,3.560,3.700,3.841,3.982,4.124,4.266,4.409,4.553,4.698,4.843,4.989,5.136,5.283,5.431,5.580,5.730,5.880,6.032,6.184,6.336,6.490,6.645,6.800,6.956,7.113,7.271,7.429,7.589,7.750,7.911,8.073,8.236,8.401,8.566,8.732,8.899,9.067,9.236,9.406,9.577,9.749,9.922,10.096,10.272,10.448,10.625,10.804,10.984,11.165,11.347,11.530,11.714,11.900,12.086,12.275,12.464,12.654,12.846,13.039,13.234,13.429,13.626,13.825,14.025,14.226,14.429,14.633,14.838,15.045,15.254};
double RIGHT_UP[193] = {-15.254,-15.045,-14.838,-14.633,-14.429,-14.226,-14.025,-13.825,-13.626,-13.429,-13.234,-13.039,-12.846,-12.654,-12.464,-12.275,-12.086,-11.900,-11.714,-11.530,-11.347,-11.165,-10.984,-10.804,-10.625,-10.448,-10.272,-10.096,-9.922,-9.749,-9.577,-9.406,-9.236,-9.067,-8.899,-8.732,-8.566,-8.401,-8.236,-8.073,-7.911,-7.750,-7.589,-7.429,-7.271,-7.113,-6.956,-6.800,-6.645,-6.490,-6.336,-6.184,-6.032,-5.880,-5.730,-5.580,-5.431,-5.283,-5.136,-4.989,-4.843,-4.698,-4.553,-4.409,-4.266,-4.124,-3.982,-3.841,-3.700,-3.560,-3.421,-3.282,-3.144,-3.007,-2.870,-2.734,-2.598,-2.463,-2.329,-2.195,-2.062,-1.929,-1.797,-1.665,-1.534,-1.404,-1.274,-1.144,-1.015,-0.886,-0.758,-0.631,-0.504,-0.377,-0.251,-0.125,0.000,0.125,0.249,0.373,1.496,0.619,0.742,0.864,0.986,1.107,1.228,1.349,1.469,1.589,1.709,1.828,1.946,2.065,2.183,2.300,2.418,2.535,2.651,2.767,2.883,2.999,3.114,3.229,3.344,3.459,3.573,3.686,3.800,3.913,4.026,4.139,4.251,4.363,4.475,4.587,4.698,4.809,4.920,5.031,5.141,5.252,5.361,5.471,5.581,5.690,5.799,5.908,6.017,6.125,6.233,6.341,6.449,6.557,6.664,6.772,6.879,6.986,7.093,7.199,7.306,7.412,7.518,7.625,7.730,7.836,7.942,8.047,8.153,8.258,8.363,8.468,8.573,8.678,8.782,8.887,8.991,9.096,9.200,9.304,9.408,9.512,9.616,9.720,9.824,9.927,10.031,10.134,10.238,10.341,10.445,10.548,10.651};
double LEFT_DOWN[193] = {10.651,10.548,10.445,10.341,10.238,10.134,10.031,9.927,9.824,9.720,9.616,9.512,9.408,9.304,9.200,9.096,8.991,8.887,8.782,8.678,8.573,8.468,8.363,8.258,8.153,8.047,7.942,7.836,7.730,7.625,7.518,7.412,7.306,7.199,7.093,6.986,6.879,6.772,6.664,6.557,6.449,6.341,6.233,6.125,6.017,5.908,5.799,5.690,5.581,5.471,5.361,5.252,5.141,5.031,4.920,4.809,4.698,4.587,4.475,4.363,4.251,4.139,4.026,3.913,3.800,3.686,3.573,3.459,3.344,3.229,3.114,2.999,2.883,2.767,2.651,2.535,2.418,2.300,2.183,2.065,1.946,1.828,1.709,1.589,1.469,1.349,1.228,1.107,0.986,0.864,0.742,0.619,1.496,0.373,0.249,0.125,0.000,-0.125,-0.251,-0.377,-0.504,-0.631,-0.758,-0.886,-1.015,-1.144,-1.274,-1.404,-1.534,-1.665,-1.797,-1.929,-2.062,-2.195,-2.329,-2.463,-2.598,-2.734,-2.870,-3.007,-3.144,-3.282,-3.421,-3.560,-3.700,-3.841,-3.982,-4.124,-4.266,-4.409,-4.553,-4.698,-4.843,-4.989,-5.136,-5.283,-5.431,-5.580,-5.730,-5.880,-6.032,-6.184,-6.336,-6.490,-6.645,-6.800,-6.956,-7.113,-7.271,-7.429,-7.589,-7.750,-7.911,-8.073,-8.236,-8.401,-8.566,-8.732,-8.899,-9.067,-9.236,-9.406,-9.577,-9.749,-9.922,-10.096,-10.272,-10.448,-10.625,-10.804,-10.984,-11.165,-11.347,-11.530,-11.714,-11.900,-12.086,-12.275,-12.464,-12.654,-12.846,-13.039,-13.234,-13.429,-13.626,-13.825,-14.025,-14.226,-14.429,-14.633,-14.838,-15.045,-15.254};
double RIGHT_DOWN[193] = {15.254,15.045,14.838,14.633,14.429,14.226,14.025,13.825,13.626,13.429,13.234,13.039,12.846,12.654,12.464,12.275,12.086,11.900,11.714,11.530,11.347,11.165,10.984,10.804,10.625,10.448,10.272,10.096,9.922,9.749,9.577,9.406,9.236,9.067,8.899,8.732,8.566,8.401,8.236,8.073,7.911,7.750,7.589,7.429,7.271,7.113,6.956,6.800,6.645,6.490,6.336,6.184,6.032,5.880,5.730,5.580,5.431,5.283,5.136,4.989,4.843,4.698,4.553,4.409,4.266,4.124,3.982,3.841,3.700,3.560,3.421,3.282,3.144,3.007,2.870,2.734,2.598,2.463,2.329,2.195,2.062,1.929,1.797,1.665,1.534,1.404,1.274,1.144,1.015,0.886,0.758,0.631,0.504,0.377,0.251,0.125,0.000,-0.125,-0.249,-0.373,-1.496,-0.619,-0.742,-0.864,-0.986,-1.107,-1.228,-1.349,-1.469,-1.589,-1.709,-1.828,-1.946,-2.065,-2.183,-2.300,-2.418,-2.535,-2.651,-2.767,-2.883,-2.999,-3.114,-3.229,-3.344,-3.459,-3.573,-3.686,-3.800,-3.913,-4.026,-4.139,-4.251,-4.363,-4.475,-4.587,-4.698,-4.809,-4.920,-5.031,-5.141,-5.252,-5.361,-5.471,-5.581,-5.690,-5.799,-5.908,-6.017,-6.125,-6.233,-6.341,-6.449,-6.557,-6.664,-6.772,-6.879,-6.986,-7.093,-7.199,-7.306,-7.412,-7.518,-7.625,-7.730,-7.836,-7.942,-8.047,-8.153,-8.258,-8.363,-8.468,-8.573,-8.678,-8.782,-8.887,-8.991,-9.096,-9.200,-9.304,-9.408,-9.512,-9.616,-9.720,-9.824,-9.927,-10.031,-10.134,-10.238,-10.341,-10.445,-10.548,-10.651};
double SPEED_RITIO_LEFT[193] = {1.310,1.306,1.302,1.299,1.295,1.291,1.287,1.284,1.280,1.276,1.273,1.269,1.265,1.262,1.258,1.254,1.251,1.247,1.244,1.240,1.237,1.233,1.230,1.226,1.223,1.219,1.216,1.212,1.209,1.206,1.202,1.199,1.196,1.192,1.189,1.186,1.182,1.179,1.176,1.172,1.169,1.166,1.163,1.159,1.156,1.153,1.150,1.147,1.143,1.140,1.137,1.134,1.131,1.128,1.124,1.121,1.118,1.115,1.112,1.109,1.106,1.103,1.100,1.097,1.094,1.091,1.088,1.085,1.082,1.079,1.076,1.073,1.070,1.067,1.064,1.061,1.058,1.055,1.052,1.049,1.046,1.043,1.040,1.037,1.034,1.032,1.029,1.026,1.023,1.020,1.017,1.014,1.011,1.009,1.006,1.003,1.000,0.997,0.994,0.992,0.989,0.986,0.983,0.980,0.977,0.975,0.972,0.969,0.966,0.964,0.961,0.958,0.955,0.952,0.950,0.947,0.944,0.941,0.939,0.936,0.933,0.930,0.928,0.925,0.922,0.919,0.917,0.914,0.911,0.909,0.906,0.903,0.900,0.898,0.895,0.892,0.890,0.887,0.884,0.881,0.879,0.876,0.873,0.871,0.868,0.865,0.863,0.860,0.857,0.855,0.852,0.849,0.847,0.844,0.841,0.839,0.836,0.833,0.831,0.828,0.825,0.823,0.820,0.817,0.815,0.812,0.809,0.807,0.804,0.801,0.799,0.796,0.793,0.791,0.788,0.785,0.783,0.780,0.777,0.775,0.772,0.769,0.767,0.764,0.762,0.759,0.756,0.754,0.751,0.748,0.746,0.743,0.740};
double SPEED_RITIO_RIGHT[193] = {0.740,0.743,0.746,0.748,0.751,0.754,0.756,0.759,0.762,0.764,0.767,0.769,0.772,0.775,0.777,0.780,0.783,0.785,0.788,0.791,0.793,0.796,0.799,0.801,0.804,0.807,0.809,0.812,0.815,0.817,0.820,0.823,0.825,0.828,0.831,0.833,0.836,0.839,0.841,0.844,0.847,0.849,0.852,0.855,0.857,0.860,0.863,0.865,0.868,0.871,0.873,0.876,0.879,0.881,0.884,0.887,0.890,0.892,0.895,0.898,0.900,0.903,0.906,0.909,0.911,0.914,0.917,0.919,0.922,0.925,0.928,0.930,0.933,0.936,0.939,0.941,0.944,0.947,0.950,0.952,0.955,0.958,0.961,0.964,0.966,0.969,0.972,0.975,0.977,0.980,0.983,0.986,0.989,0.992,0.994,0.997,1.000,1.003,1.006,1.009,1.011,1.014,1.017,1.020,1.023,1.026,1.029,1.032,1.034,1.037,1.040,1.043,1.046,1.049,1.052,1.055,1.058,1.061,1.064,1.067,1.070,1.073,1.076,1.079,1.082,1.085,1.088,1.091,1.094,1.097,1.100,1.103,1.106,1.109,1.112,1.115,1.118,1.121,1.124,1.128,1.131,1.134,1.137,1.140,1.143,1.147,1.150,1.153,1.156,1.159,1.163,1.166,1.169,1.172,1.176,1.179,1.182,1.186,1.189,1.192,1.196,1.199,1.202,1.206,1.209,1.212,1.216,1.219,1.223,1.226,1.230,1.233,1.237,1.240,1.244,1.247,1.251,1.254,1.258,1.262,1.265,1.269,1.273,1.276,1.280,1.284,1.287,1.291,1.295,1.299,1.302,1.306,1.310};

//四轮转向
void angleSpeedConvert(drobot_msgs::DrobotControl &control_msgs, double axisA, double axisB)
{
	int indexNum = 96 + axisB*85;
	double average_speed = axisA * MAX_VELOCITY;
	if(control_msgs.gear_mode > 1)
	{
		average_speed = axisA * MAX_HIGH_VELOCITY;
	}

	control_msgs.left_front_steer = LEFT_UP[indexNum]; //
	control_msgs.right_front_steer = RIGHT_UP[indexNum];
	control_msgs.left_rear_steer = LEFT_DOWN[indexNum];
	control_msgs.right_rear_steer = RIGHT_DOWN[indexNum];

	control_msgs.left_front_speed = SPEED_RITIO_LEFT[indexNum] * average_speed; //
	control_msgs.right_front_speed = SPEED_RITIO_RIGHT[indexNum] * average_speed;
	control_msgs.left_rear_speed = SPEED_RITIO_LEFT[indexNum] * average_speed;
	control_msgs.right_rear_speed = SPEED_RITIO_RIGHT[indexNum] * average_speed;

	if(abs(average_speed) < 0.1)
	{
		control_msgs.left_front_steer += -BIAS_STEER; //
		control_msgs.right_front_steer += BIAS_STEER;
		control_msgs.left_rear_steer += BIAS_STEER;
		control_msgs.right_rear_steer += -BIAS_STEER;
	}
}

//原地转向
void angleConvertStopAndTurn(drobot_msgs::DrobotControl &control_msgs, double axisA)
{
	control_msgs.left_front_steer = -POINT_TURN_ANGLE;
	control_msgs.right_front_steer = POINT_TURN_ANGLE;
	control_msgs.left_rear_steer = POINT_TURN_ANGLE;
	control_msgs.right_rear_steer = -POINT_TURN_ANGLE;

	double average_speed = axisA * POINT_TURN_VELOCITY;
	control_msgs.left_front_speed = -average_speed; //
	control_msgs.right_front_speed = average_speed;
	control_msgs.left_rear_speed = -average_speed;
	control_msgs.right_rear_speed = average_speed;
}


void stopMode(drobot_msgs::DrobotControl &control_msgs)
{
	control_msgs.left_front_steer = -BIAS_STEER; //
	control_msgs.right_front_steer = BIAS_STEER;
	control_msgs.left_rear_steer = BIAS_STEER;
	control_msgs.right_rear_steer = -BIAS_STEER;

	control_msgs.left_front_speed = 0; //
	control_msgs.right_front_speed = 0;
	control_msgs.left_rear_speed = 0;
	control_msgs.right_rear_speed = 0;

	control_msgs.stop_mode = true;
	control_msgs.point_turn_mode = false;
}

#endif
